<!DOCTYPE html>
<html>
<head>
<meta charset='UTF-8'>
<title>게시판 목록</title>
</head>
<body>
<h1>게시판 목록2</h1>
<p><a href='form'>새 게시글</a></p>
<table id='eListTable' border='1'>
<thead>
<tr>
    <th>번호</th><th>제목</th><th>날짜</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
<div>

<button id='ePrevBtn'>이전</button>

<span id='ePageNo'></span>

<button id='eNextBtn'>다음</button>

</div>
<script src="../js/hanriver.js"></script>
<script src="../js/common.js"></script>
<script>
"use strict"
var data;

var tbody = $('#eListTable > tbody');


var {page, size} = $.parseQuery(location.href);


if (size == undefined || page == undefined) 
    loadList(1, 3);
else loadList(page, size);

ePrevBtn.on("click", function() {
    loadList(data.page - 1, data.size);
});

eNextBtn.click(function() {
	loadList(data.page + 1, data.size)
});



function loadList(page, size) {
    var xhr = new XMLHttpRequest();
    
    xhr.onreadystatechange = function() {
        if (xhr.readyState < 4) return;
        if (xhr.status !== 200) {
            alert("서버에서 오류 발생!");
            return;
        }
        data = JSON.parse(xhr.responseText);
        tbody.innerHTML = "";
        for (var item of data.list) {
            var tr = $("<tr>");
            tr.innerHTML = 
                `<td>${item.no}</td><td><a href='#' data-no='${item.no}' onclick='clickViewLink(event)'>${item.title}</a></td>
                <td>${item.date}</td>`;
                tbody.append(tr);
        }
        ePageNo.innerHTML = data.page;
        if (data.page <= 1)
            $('#ePrevBtn').attr('disabled', '');
        else 
            $('#ePrevBtn').removeAttr('disabled');
        
        if (data.page >= data.totalPage)
            $('#eNextBtn').attr('disabled', '');
        else
        	$('#eNextBtn').removeAttr('disabled');
    };
    
    xhr.open('GET', 
            serverApiAddr + `/json/notice/list?page=${page}&size=${size}`, 
            true);
    xhr.send();
}

function clickViewLink(event) {
    event.preventDefault();
    var id = $(event.currentTarget).attr('data-no');
    location.href = `view.html?no=${id}&page=${data.page}&size=${data.size}`;
}
</script>
</body>
</html>








